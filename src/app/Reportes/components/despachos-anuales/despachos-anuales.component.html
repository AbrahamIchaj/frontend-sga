<div class="section-stack text-body">
  <div class="card">
    <div class="card-header">
      <h1 class="card-title">Despachos por año</h1>
      <p class="card-subtitle">
        Revisa los despachos mensuales con detalle de unidades, monto y número de envíos por renglón.
      </p>
    </div>
    <form [formGroup]="filtrosForm" class="filters-grid" (ngSubmit)="cargarDatos()">
      <div class="form-field">
        <label for="anioInicio" class="form-label">Año inicial</label>
        <input
          id="anioInicio"
          type="number"
          min="2000"
          class="form-control"
          formControlName="anioInicio"
        />
      </div>
      <div class="form-field">
        <label for="anioFin" class="form-label">Año final</label>
        <input
          id="anioFin"
          type="number"
          min="2000"
          class="form-control"
          formControlName="anioFin"
        />
      </div>
      <div class="form-field">
        <label for="renglon" class="form-label">Renglón</label>
        <select id="renglon" class="form-control" formControlName="renglon">
          <option value="">Todos</option>
          <option
            *ngFor="let renglon of renglonesDisponibles()"
            [ngValue]="renglon"
          >
            {{ renglon }}
          </option>
        </select>
      </div>
      <div class="form-actions">
        <button type="submit" class="btn btn-primary" [disabled]="cargando()">
          <i class="fas fa-sync-alt mr-2"></i>
          Consultar
        </button>
        <button
          type="button"
          class="btn btn-secondary"
          (click)="limpiarFiltros()"
          [disabled]="cargando()"
        >
          Restablecer
        </button>
      </div>
    </form>
  </div>

  <div class="status-card" *ngIf="cargando()">
    <i class="fas fa-spinner fa-spin mr-2"></i>
    Cargando información de despachos anuales...
  </div>

  <ng-container *ngIf="!cargando() && reporte() as data">
    <div class="grid-cards">
      <div class="metric-card">
        <span class="metric-label">Total de despachos</span>
        <span class="metric-value">{{ resumenGeneral().totalRegistros | number }}</span>
      </div>
      <div class="metric-card">
        <span class="metric-label">Unidades enviadas</span>
        <span class="metric-value">{{ resumenGeneral().totalCantidad | number:'1.0-0' }}</span>
      </div>
      <div class="metric-card">
  <span class="metric-label">Monto total</span>
  <span class="metric-value">{{ resumenGeneral().totalGeneral | quetzales }}</span>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <h2 class="card-title">Detalle mensual</h2>
        <p class="card-subtitle">Una fila por año y mes según los filtros establecidos.</p>
      </div>
      <div class="table-responsive">
        <table class="data-table">
          <thead>
            <tr>
              <th>Año</th>
              <th>Mes</th>
              <th>Despachos</th>
              <th>Unidades</th>
              <th>Monto</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngIf="filasTabla().length === 0">
              <td colspan="5" class="text-muted text-center py-6">
                No se encontraron registros para los parámetros seleccionados.
              </td>
            </tr>
            <tr *ngFor="let fila of filasTabla()">
              <td>{{ fila.anio }}</td>
              <td>{{ fila.nombreMes }}</td>
              <td class="text-right">{{ fila.totalRegistros | number }}</td>
              <td class="text-right">{{ fila.totalCantidad | number:'1.0-0' }}</td>
              <td class="text-right">{{ fila.totalGeneral | quetzales }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </ng-container>
</div>
