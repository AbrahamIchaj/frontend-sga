<div class="dashboard">
  <section class="hero">
    <div class="hero__content">
      <div>
        <p class="hero__pill">Panel Operativo</p>
        <h1 class="hero__title">Hola {{ currentUser?.nombres }}</h1>
        <p class="hero__subtitle">
          {{ currentUser?.rol?.nombreRol }} ·
          {{ currentUser?.rol?.descripcion }}
        </p>
        <div class="hero__meta" *ngIf="resumen as data">
          <span class="hero__meta-dot"></span>
          <span
            >Actualizado:
            {{ data.metrics.ultimaActualizacion | date : "medium" }}</span
          >
        </div>
      </div>
      <button class="hero__logout" (click)="logout()">
        <i class="fa-solid fa-right-from-bracket"></i>
        Cerrar sesión
      </button>
    </div>
  </section>

  <section class="alert" *ngIf="error">
    <div class="alert__icon">⚠️</div>
    <div>
      <h3>Algo salió mal</h3>
      <p>{{ error }}</p>
    </div>
    <button class="alert__retry" (click)="cargarResumen()">Reintentar</button>
  </section>

  <section class="metrics" *ngIf="!loading && resumen as data">
    <article class="metric-card metric-card--primary">
      <div class="metric-card__icon">
        <i class="fa-solid fa-warehouse"></i>
      </div>
      <div>
        <p class="metric-card__label">Insumos únicos registrados</p>
        <h2 class="metric-card__value">
          {{ data.metrics.totalInsumos | number }}
        </h2>
        <p class="metric-card__footer">
          {{ data.metrics.totalExistencias | number }} existencias totales
        </p>
      </div>
    </article>

    <article class="metric-card metric-card--primary">
      <div class="metric-card__icon metric-card__icon--amber">
        <i class="fa-solid fa-triangle-exclamation"></i>
      </div>
      <div>
        <p class="metric-card__label">Insumos próximos a vencer (6 meses)</p>
        <h2 class="metric-card__value">
          {{ data.metrics.insumosProximosVencer | number }}
        </h2>
      </div>
    </article>

    <article class="metric-card metric-card--primary">
      <div class="metric-card__icon metric-card__icon--rose">
        <i class="fa-solid fa-skull-crossbones"></i>
      </div>
      <div>
        <p class="metric-card__label">Insumos vencidos</p>
        <h2 class="metric-card__value">
          {{ data.metrics.insumosVencidos | number }}
        </h2>
      </div>
    </article>

    <article class="metric-card metric-card--primary">
      <div class="metric-card__icon metric-card__icon--indigo">
        <i class="fa-solid fa-dollar-sign"></i>
      </div>
      <div>
        <p class="metric-card__label">Valor monetario del inventario</p>
        <h2 class="metric-card__value">
          {{
            data.metrics.valorInventario
              | currency : "GTQ" : "symbol-narrow" : "1.0-0"
          }}
        </h2>
      </div>
    </article>

    <article class="metric-card metric-card--primary">
      <div class="metric-card__icon metric-card__icon--emerald">
        <i class="fa-solid fa-cart-flatbed"></i>
      </div>
      <div>
        <p class="metric-card__label">Total de ingresos de compras</p>
        <h2 class="metric-card__value">
          {{
            data.metrics.totalIngresosCompras
              | currency : "GTQ" : "symbol-narrow" : "1.0-0"
          }}
        </h2>
      </div>
    </article>

    <article class="metric-card metric-card--primary">
      <div class="metric-card__icon metric-card__icon--cyan">
        <i class="fa-solid fa-calendar-check"></i>
      </div>
      <div>
        <p class="metric-card__label">
          Ingresos del mes ({{ data.metrics.mesActual | titlecase }})
        </p>
        <div class="metric-card__double">
          <h2 class="metric-card__value">
            {{ data.metrics.comprasMesActual | number }}
          </h2>
          <span class="metric-card__caption">compras</span>
        </div>
        <p class="metric-card__footer">
          {{ data.metrics.insumosIngresadosMes | number }} insumos ·
          {{
            data.metrics.montoComprasMes
              | currency : "GTQ" : "symbol-narrow" : "1.0-0"
          }}
        </p>
      </div>
    </article>
  </section>

  <section class="metrics metrics--skeleton" *ngIf="loading">
    <div
      *ngFor="let skeleton of [1, 2, 3, 4, 5, 6]"
      class="metric-card metric-card--skeleton"
    ></div>
  </section>

  <section class="analytics" *ngIf="!loading && resumen as data">
    <div class="analytics__panel analytics__panel--wide">
      <header class="analytics__header">
        <div>
          <h3>Gráfica de entradas vs despachos</h3>
          <p>Comportamiento de los últimos 6 meses</p>
        </div>
      </header>
      <div class="analytics__chart">
        <canvas #ingresosChart></canvas>
      </div>
    </div>

    <div class="analytics__panel">
      <header class="analytics__header">
        <div>
          <h3>Top proveedores del año</h3>
          <p>Ranking por monto acumulado</p>
        </div>
      </header>
      <div class="analytics__chart analytics__chart--medium">
        <canvas #proveedoresChart></canvas>
      </div>
    </div>
  </section>
</div>
