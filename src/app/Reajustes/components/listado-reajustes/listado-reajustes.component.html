<div class="section-stack text-body">
  <div class="rounded-xl border border-gray-700 bg-gray-800 shadow-lg">
    <div class="card-responsive__body space-y-4">
      <h1 class="text-lg font-bold text-heading inline-flex items-center">
        REAJUSTES
        <span class="text-lg mx-2 text-gray-400">|</span>
        <svg
          class="inline w-5 h-5 mr-1 align-middle"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
          ></path>
        </svg>
        Filtros de Búsqueda
      </h1>
      <div
        class="grid grid-cols-1 gap-4 md:grid-cols-2 xl:grid-cols-4"
      >
        <div>
          
          <label class="block text-sm font-medium text-muted-strong mb-1"
            >Referencia</label
          >
          <input
            type="text"
            [(ngModel)]="filtros.referencia"
            (ngModelChange)="onFilterChange()"
            placeholder="Documento, referencia..."
            class="w-full px-4 py-2 rounded-lg bg-slate-900/70 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-muted-strong mb-1"
            >Tipo de reajuste</label
          >
          <div class="relative">
            <select
              [(ngModel)]="filtros.tipoReajuste"
              (ngModelChange)="onFilterChange()"
              class="w-full px-4 py-2 rounded-lg bg-slate-900/70 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="">Todos</option>
              <option value="1">Entradas</option>
            </select>
            <span
              class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-3 text-muted"
            >
              <svg
                class="h-4 w-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M19 9l-7 7-7-7"
                ></path>
              </svg>
            </span>
          </div>
        </div>

        <div>
          <label class="block text-sm font-medium text-muted-strong mb-1"
            >Fecha desde</label
          >
          <input
            type="date"
            [(ngModel)]="filtros.fechaDesde"
            (ngModelChange)="onFilterChange()"
            class="w-full px-4 py-2 rounded-lg bg-slate-900/70 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>

        <div>
          <label class="block text-sm font-medium text-muted-strong mb-1"
            >Fecha hasta</label
          >
          <input
            type="date"
            [(ngModel)]="filtros.fechaHasta"
            (ngModelChange)="onFilterChange()"
            class="w-full px-4 py-2 rounded-lg bg-slate-900/70 border border-slate-700 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
      </div>

      <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
        <button
          type="button"
          (click)="clearFilters()"
          class="inline-flex items-center justify-start border border-red-500 text-red-500 hover:bg-red-500 hover:text-white px-2 py-2 rounded-xl"
        >
         <svg
            class="w-4 h-4 mr-2"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
            ></path>
          </svg>
           Limpiar filtros
        </button>
        <button
      type="button"
      (click)="crearReajuste()"
      class="btn-primary-dark ml-auto"
    >
      <i class="fas fa-plus mr-2"></i>
      Nuevo reajuste
    </button>
      </div>
      
    </div>
  </div>

  <div *ngIf="error" class="alert alert-danger flex items-center gap-2">
    <i class="fas fa-exclamation-triangle"></i>
    {{ error }}
  </div>

  <div class="card-responsive overflow-hidden">
    <div class="px-6 py-4 border-b border-subtle bg-surface-alt flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
      <div>
        <h3 class="text-lg font-semibold text-heading">Listado de reajustes</h3>
        <p class="text-xs text-muted">
          Resultados: {{ meta.total || registros.length }} registros totales.
        </p>
      </div>
      <div class="text-sm text-muted">
        Página {{ meta.page }} de {{ meta.totalPages }}
      </div>
    </div>

    <div class="table-responsive">
      <table class="min-w-full divide-y divide-slate-800/60">
        <thead class="bg-surface-alt">
          <tr class="text-left text-xs font-semibold uppercase tracking-wide text-muted-strong">
            <th class="px-4 py-3">Fecha</th>
            <th class="px-4 py-3">Tipo</th>
            <th class="px-4 py-3">Referencia</th>
            <th class="px-4 py-3">Usuario</th>
            <th class="px-4 py-3 text-center">Detalles</th>
            <th class="px-4 py-3 text-center">Total unidades</th>
            <th class="px-4 py-3">Acciones</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-800/40">
          <tr *ngIf="loading">
            <td colspan="7" class="px-4 py-10 text-center text-sm text-muted">
              Cargando reajustes...
            </td>
          </tr>
          <tr
            *ngFor="let registro of registros; trackBy: trackById"
            class="hover:bg-surface-alt/70 transition"
          >
            <td class="px-4 py-3 text-sm text-body">
              {{ formatearFecha(registro.fechaReajuste) }}
            </td>
            <td class="px-4 py-3">
              <span
                class="inline-flex rounded-full px-2.5 py-1 text-xs font-semibold"
                [ngClass]="tipoClase(registro.tipoReajuste)"
              >
                {{ tipoLabel(registro.tipoReajuste) }}
              </span>
            </td>
            <td class="px-4 py-3 text-sm font-medium text-heading">
              <span class="block">{{ registro.referenciaDocumento }}</span>
              <span *ngIf="registro.observaciones" class="text-xs text-muted">
                {{ registro.observaciones }}
              </span>
            </td>
            <td class="px-4 py-3 text-sm text-body">
              {{ registro.usuarioNombre || "Sin usuario" }}
            </td>
            <td class="px-4 py-3 text-center text-sm text-body">
              {{ registro.cantidadDetalles }}
            </td>
            <td class="px-4 py-3 text-center text-sm font-semibold text-heading">
              {{ registro.totalCantidad }}
            </td>
            <td class="px-4 py-3">
              <div class="flex flex-wrap items-center gap-2">
                <button
                  type="button"
                  (click)="verDetalle(registro)"
                  class="inline-flex items-center justify-center gap-2 rounded-lg border border-blue-500/60 px-3 py-1.5 text-xs font-semibold text-blue-300 transition hover:bg-blue-500/20 hover:text-white"
                >
                  Ver detalle
                </button>
                <button
                  type="button"
                  (click)="eliminarReajuste(registro)"
                  class="inline-flex items-center justify-center gap-2 rounded-lg border border-red-500/70 px-3 py-1.5 text-xs font-semibold text-red-300 transition hover:bg-red-500/10"
                >
                  Eliminar
                </button>
              </div>
            </td>
          </tr>
          <tr *ngIf="!loading && registros.length === 0">
            <td colspan="7" class="px-4 py-12 text-center text-sm text-muted">
              No se encontraron reajustes con los filtros actuales.
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="flex flex-col gap-3 border-t border-subtle bg-surface-alt px-4 py-3 text-xs text-muted md:flex-row md:items-center md:justify-between">
      <div>
        Mostrando
        <span class="font-semibold text-heading">{{ mostrandoDesde }}</span>
        -
        <span class="font-semibold text-heading">{{ mostrandoHasta }}</span>
        de
        <span class="font-semibold text-heading">{{ meta.total }}</span>
        registros
      </div>
      <div class="flex items-center justify-end gap-2">
        <button
          type="button"
          (click)="goToPage(meta.page - 1)"
          [disabled]="meta.page <= 1 || loading"
          class="inline-flex items-center justify-center rounded-lg bg-slate-800/70 px-3 py-1.5 text-xs font-semibold text-muted transition hover:bg-slate-700/70 hover:text-heading disabled:cursor-not-allowed disabled:bg-slate-800/40 disabled:text-muted"
        >
          Anterior
        </button>
        <span class="text-muted">Página {{ meta.page }} de {{ meta.totalPages }}</span>
        <button
          type="button"
          (click)="goToPage(meta.page + 1)"
          [disabled]="meta.page >= meta.totalPages || loading"
          class="inline-flex items-center justify-center rounded-lg bg-slate-800/70 px-3 py-1.5 text-xs font-semibold text-muted transition hover:bg-slate-700/70 hover:text-heading disabled:cursor-not-allowed disabled:bg-slate-800/40 disabled:text-muted"
        >
          Siguiente
        </button>
      </div>
    </div>
  </div>
</div>
