<div class="section-stack text-body">
  <div class="flex flex-wrap items-center gap-3"></div>

  <div *ngIf="loading" class="alert text-center text-sm text-muted">
    Cargando información del reajuste...
  </div>

  <div
    *ngIf="error && !loading"
    class="alert alert-danger flex items-center gap-2"
  >
    <i class="fas fa-exclamation-triangle"></i>
    {{ error }}
  </div>

  <ng-container *ngIf="!loading && reajuste">
    <div class="rounded-xl border border-gray-700 bg-gray-800 shadow-lg">
      <div class="card-responsive__body">
        <div class="grid gap-4 md:grid-cols-2">
          <div class="space-y-1">
            <h1 class="text-lg font-bold text-heading inline-flex items-center">
              DETALLE DE REAJUSTE
            </h1>
            <div class="text-xs uppercase tracking-wide text-muted">
              Fecha de reajuste
            </div>
            <div class="text-lg font-semibold text-heading">
              {{ formatearFecha(reajuste.fechaReajuste) }}
            </div>
          </div>
          <div class="space-y-1">
            <div class="text-xs uppercase tracking-wide text-muted">
              Tipo de movimiento
            </div>
            <span
              class="inline-flex rounded-full px-3 py-1 text-xs font-semibold"
              [ngClass]="tipoClase(reajuste.tipoReajuste)"
            >
              {{ tipoLabel(reajuste.tipoReajuste) }}
            </span>
          </div>
          <div class="space-y-1">
            <div class="text-xs uppercase tracking-wide text-muted">
              Referencia
            </div>
            <div class="text-lg font-semibold text-heading">
              {{ reajuste.referenciaDocumento }}
            </div>
          </div>
          <div class="space-y-1">
            <div class="text-xs uppercase tracking-wide text-muted">
              Usuario responsable
            </div>
            <div class="text-lg font-semibold text-heading">
              {{ reajuste.usuarioNombre || "No disponible" }}
            </div>
          </div>
          <div class="md:col-span-2 space-y-2">
            <div class="text-xs uppercase tracking-wide text-muted">
              Observaciones
            </div>
            <div
              class="rounded-xl border border-slate-700/60 bg-surface-alt p-4 text-sm text-body"
            >
              {{ reajuste.observaciones || "Sin observaciones registradas." }}
            </div>
          </div>
          
        </div>
      <BR>  
        <button
            type="button"
            (click)="volver()"
            class="binline-flex items-center justify-start border border-green-500 text-green-500 hover:bg-green-800 hover:text-white px-2 py-2 rounded-xl"
          >
            <i class="fa-solid fa-chevron-left mr-2"></i>
            Regresar al listado
          </button>
      </div>
    </div>

    <div class="card-responsive overflow-hidden">
      <div
        class="px-6 py-4 border-b border-subtle bg-surface-alt flex flex-col gap-2 md:flex-row md:items-center md:justify-between"
      >
        <div>
          <div class="text-lg font-semibold text-heading">
            Detalles del reajuste
          </div>
          <p class="text-xs text-muted">
            Se registraron {{ totales.lineas }} líneas con un total de
            {{ totales.cantidad }} unidades.
          </p>
        </div>
        <div class="text-sm text-muted">
          Valor estimado:
          <span class="font-semibold text-heading">{{
            totalValor | quetzales : true
          }}</span>
        </div>
      </div>

      <div class="table-responsive">
        <table class="min-w-full divide-y divide-slate-800/60">
          <thead
            class="bg-surface-alt text-xs font-semibold uppercase tracking-wide text-muted-strong"
          >
            <tr>
              <th class="px-4 py-3 text-left">Código</th>
              <th class="px-4 py-3 text-left">No. Kardex</th>
              <th class="px-4 py-3 text-left">Descripción</th>
              <th class="px-4 py-3 text-left">Presentación</th>
              <th class="px-4 py-3 text-left">Lote</th>
              <th class="px-4 py-3 text-left">Fecha venc.</th>
              <th class="px-4 py-3 text-center">Cantidad</th>
              <th class="px-4 py-3 text-right">Precio unitario</th>
              <th class="px-4 py-3 text-right">Subtotal</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-800/40 text-sm text-body">
            <tr
              *ngFor="
                let item of reajuste?.ReajusteDetalle;
                trackBy: detalleTrackBy
              "
              class="hover:bg-surface-alt/70 transition"
            >
              <td class="px-4 py-3">
                <div class="font-semibold text-heading">
                  {{ item.codigoInsumo }}
                </div>
                <div class="text-xs text-muted">
                  Renglón
                  {{
                    item.renglon || item.CatalogoInsumos?.codigoInsumo || "—"
                  }}
                </div>
              </td>
              <td class="px-4 py-3 text-sm text-body">
                {{ item.Inventario?.noKardex || "—" }}
              </td>
              <td class="px-4 py-3">
                <div class="font-medium text-heading">
                  {{ item.nombreInsumo }}
                </div>
                <div class="text-xs text-muted">
                  {{ item.caracteristicas }}
                </div>
                <div
                  *ngIf="item.observaciones"
                  class="mt-1 text-xs italic text-muted"
                >
                  {{ item.observaciones }}
                </div>
              </td>
              <td class="px-4 py-3">
                <div>
                  {{
                    item.presentacion ||
                      item.CatalogoInsumos?.nombrePresentacion ||
                      "—"
                  }}
                </div>
                <div class="text-xs text-muted">
                  {{
                    item.unidadMedida ||
                      item.CatalogoInsumos?.unidadMedida ||
                      "—"
                  }}
                </div>
              </td>
              <td class="px-4 py-3">
                {{ item.lote || "—" }}
              </td>
              <td class="px-4 py-3">
                {{ formatearFecha(item.fechaVencimiento) }}
              </td>
              <td class="px-4 py-3 text-center font-semibold text-heading">
                {{ item.cantidad }}
              </td>
              <td class="px-4 py-3 text-right">
                {{ precioUnitario(item) | quetzales : true }}
              </td>
              <td class="px-4 py-3 text-right">
                {{ precioUnitario(item) * item.cantidad | quetzales : true }}
              </td>
            </tr>
          </tbody>
          <tfoot class="bg-surface-alt text-sm font-semibold text-heading">
            <tr>
              <td colspan="6" class="px-4 py-3 text-right">Totales</td>
              <td class="px-4 py-3 text-center">{{ totales.cantidad }}</td>
              <td colspan="2" class="px-4 py-3 text-right text-emerald-300">
                {{ totalValor | quetzales : true }}
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </ng-container>
</div>
